/*! terminal 2014-05-14 */
!function(a){function b(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function c(a,b){for(var c=[];b>0;c[--b]=a);return c.join("")}var d=function(){return d.cache.hasOwnProperty(arguments[0])||(d.cache[arguments[0]]=d.parse(arguments[0])),d.format.call(null,d.cache[arguments[0]],arguments)};d.format=function(a,e){var f,g,h,i,j,k,l,m=1,n=a.length,o="",p=[];for(g=0;n>g;g++)if(o=b(a[g]),"string"===o)p.push(a[g]);else if("array"===o){if(i=a[g],i[2])for(f=e[m],h=0;h<i[2].length;h++){if(!f.hasOwnProperty(i[2][h]))throw d('[sprintf] property "%s" does not exist',i[2][h]);f=f[i[2][h]]}else f=i[1]?e[i[1]]:e[m++];if(/[^s]/.test(i[8])&&"number"!=b(f))throw d("[sprintf] expecting number but found %s",b(f));switch(i[8]){case"b":f=f.toString(2);break;case"c":f=String.fromCharCode(f);break;case"d":f=parseInt(f,10);break;case"e":f=i[7]?f.toExponential(i[7]):f.toExponential();break;case"f":f=i[7]?parseFloat(f).toFixed(i[7]):parseFloat(f);break;case"o":f=f.toString(8);break;case"s":f=(f=String(f))&&i[7]?f.substring(0,i[7]):f;break;case"u":f>>>=0;break;case"x":f=f.toString(16);break;case"X":f=f.toString(16).toUpperCase()}f=/[def]/.test(i[8])&&i[3]&&f>=0?"+"+f:f,k=i[4]?"0"==i[4]?"0":i[4].charAt(1):" ",l=i[6]-String(f).length,j=i[6]?c(k,l):"",p.push(i[5]?f+j:j+f)}return p.join("")},d.cache={},d.parse=function(a){for(var b=a,c=[],d=[],e=0;b;){if(null!==(c=/^[^\x25]+/.exec(b)))d.push(c[0]);else if(null!==(c=/^\x25{2}/.exec(b)))d.push("%");else{if(null===(c=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b)))throw"[sprintf] huh?";if(c[2]){e|=1;var f=[],g=c[2],h=[];if(null===(h=/^([a-z_][a-z_\d]*)/i.exec(g)))throw"[sprintf] huh?";for(f.push(h[1]);""!==(g=g.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(g)))f.push(h[1]);else{if(null===(h=/^\[(\d+)\]/.exec(g)))throw"[sprintf] huh?";f.push(h[1])}c[2]=f}else e|=2;if(3===e)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";d.push(c)}b=b.substring(c[0].length)}return d};var e=function(a,b,c){return c=b.slice(0),c.splice(0,0,a),d.apply(null,c)};a.sprintf=d,a.vsprintf=e}("undefined"!=typeof exports?exports:window),function(a,b){"use strict";function c(a,b){var c;if("string"==typeof a&&"string"==typeof b)return localStorage[a]=b,!0;if("object"==typeof a&&"undefined"==typeof b){for(c in a)a.hasOwnProperty(c)&&(localStorage[c]=a[c]);return!0}return!1}function d(a,b){var c,d,e;if(c=new Date,c.setTime(c.getTime()+31536e6),d="; expires="+c.toGMTString(),"string"==typeof a&&"string"==typeof b)return document.cookie=a+"="+b+d+"; path=/",!0;if("object"==typeof a&&"undefined"==typeof b){for(e in a)a.hasOwnProperty(e)&&(document.cookie=e+"="+a[e]+d+"; path=/");return!0}return!1}function e(a){return localStorage[a]}function f(a){var b,c,d,e;for(b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null}function g(a){return delete localStorage[a]}function h(a){return d(a,"",-1)}function i(a,b){var c=[],d=a.length;if(b>d)return[a];for(var e=0;d>e;e+=b)c.push(a.substring(e,e+b));return c}function j(b){var c=b?[b]:[],d=0;a.extend(this,{get:function(){return c},rotate:function(){return 1===c.length?c[0]:(d===c.length-1?d=0:++d,c[d])},length:function(){return c.length},remove:function(a){c.splice(a,0)},set:function(a){for(var b=c.length;b--;)if(c[b]===a)return void(d=b);this.append(a)},front:function(){return c[d]},append:function(a){c.push(a)}})}function k(b){var c=b?[b]:[];a.extend(this,{map:function(b){return a.map(c,b)},size:function(){return c.length},pop:function(){if(0===c.length)return null;var a=c[c.length-1];return c=c.slice(0,c.length-1),a},push:function(a){return c=c.concat([a]),a},top:function(){return c.length>0?c[c.length-1]:null}})}function l(b,c){var d=!0,e="";"string"==typeof b&&""!==b&&(e=b+"_"),e+="commands";var f=a.Storage.get(e);f=f?a.parseJSON(f):[];var g=f.length-1;a.extend(this,{append:function(b){d&&f[f.length-1]!==b&&(f.push(b),c&&f.length>c&&(f=f.slice(-c)),g=f.length-1,a.Storage.set(e,a.json_stringify(f)))},data:function(){return f},reset:function(){g=f.length-1},last:function(){return f[length-1]},end:function(){return g===f.length-1},position:function(){return g},current:function(){return f[g]},next:function(){return g<f.length-1&&++g,-1!==g?f[g]:void 0},previous:function(){var a=g;return g>0&&--g,-1!==a?f[g]:void 0},clear:function(){f=[],this.purge()},enabled:function(){return d},enable:function(){d=!0},purge:function(){a.Storage.remove(e)},disable:function(){d=!1}})}function m(b){return a("<div>"+a.terminal.strip(b)+"</div>").text().length}function n(){var a=!1,c="animation",d="",e="Webkit Moz O ms Khtml".split(" "),f="",g=document.createElement("div");if(g.style.animationName&&(a=!0),a===!1)for(var h=0;h<e.length;h++){var i=e[h]+"AnimationName";if(g.style[i]!==b){f=e[h],c=f+"Animation",d="-"+f.toLowerCase()+"-",a=!0;break}}return a}function o(a,b){var c=a.match(/^([^\s]+)\s*(.*)$/);return c?{name:c[1],args:b(c[2]),rest:c[2]}:{name:"",args:[],rest:""}}function p(b){var c=a(window).scrollTop(),d=c+a(window).height(),e=a(b).offset().top,f=e+a(b).height();return f>=c&&d>=e}function q(){var b=a('<div class="terminal"><div class="cmd"><span>&nbsp;</span></div></div>').appendTo("body"),c=b.find("span"),d={width:c.width(),height:c.outerHeight()};return b.remove(),d}function r(a){var b=q().width,c=Math.floor(a.width()/b);if(u(a)){var d=20,e=a.innerWidth()-a.width();c-=Math.ceil((d-e/2)/(b-1))}return c}function s(a){return Math.floor(a.height()/q().height)}function t(){if(window.getSelection||document.getSelection){var a=(window.getSelection||document.getSelection)();return a.text?a.text:a.toString()}return document.selection?document.selection.createRange().text:void 0}function u(a){return a.get(0).scrollHeight>a.innerHeight()}a.omap=function(b,c){var d={};return a.each(b,function(a,e){d[a]=c.call(b,a,e)}),d};var v={cloneObject:function(b){var c={};if("object"==typeof b){if(a.isArray(b))return this.cloneArray(b);if(null==b)return b;for(var d in b)c[d]=a.isArray(b[d])?this.cloneArray(b[d]):"object"==typeof b[d]?this.cloneObject(b[d]):b[d]}return c},cloneArray:function(b){if(!a.isFunction(Array.prototype.map))throw new Error("You'r browser don't support ES5 array map use es5-shim");return b.slice(0).map(function(a){return"object"==typeof a?this.cloneObject(a):a}.bind(this))}},w=function(a){return v.cloneObject(a)},x="undefined"!=typeof window.localStorage;a.extend({Storage:{set:x?c:d,get:x?e:f,remove:x?g:h}}),jQuery.fn.extend({everyTime:function(a,b,c,d,e){return this.each(function(){jQuery.timer.add(this,a,b,c,d,e)})},oneTime:function(a,b,c){return this.each(function(){jQuery.timer.add(this,a,b,c,1)})},stopTime:function(a,b){return this.each(function(){jQuery.timer.remove(this,a,b)})}}),jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1e3,das:1e4,hs:1e5,ks:1e6},timeParse:function(a){if(a===b||null===a)return null;var c=this.regex.exec(jQuery.trim(a.toString()));if(c[2]){var d=parseInt(c[1],10),e=this.powers[c[2]]||1;return d*e}return a},add:function(a,b,c,d,e,f){var g=0;if(jQuery.isFunction(c)&&(e||(e=d),d=c,c=b),b=jQuery.timer.timeParse(b),!("number"!=typeof b||isNaN(b)||0>=b)){e&&e.constructor!==Number&&(f=!!e,e=0),e=e||0,f=f||!1,a.$timers||(a.$timers={}),a.$timers[c]||(a.$timers[c]={}),d.$timerID=d.$timerID||this.guid++;var h=function(){f&&h.inProgress||(h.inProgress=!0,(++g>e&&0!==e||d.call(a,g)===!1)&&jQuery.timer.remove(a,c,d),h.inProgress=!1)};h.$timerID=d.$timerID,a.$timers[c][d.$timerID]||(a.$timers[c][d.$timerID]=window.setInterval(h,b)),this.global[c]||(this.global[c]=[]),this.global[c].push(a)}},remove:function(a,b,c){var d,e=a.$timers;if(e){if(b){if(e[b]){if(c)c.$timerID&&(window.clearInterval(e[b][c.$timerID]),delete e[b][c.$timerID]);else for(var f in e[b])e[b].hasOwnProperty(f)&&(window.clearInterval(e[b][f]),delete e[b][f]);for(d in e[b])if(e[b].hasOwnProperty(d))break;d||(d=null,delete e[b])}}else for(var g in e)e.hasOwnProperty(g)&&this.remove(a,g,c);for(d in e)if(e.hasOwnProperty(d))break;d||(a.$timers=null)}}}}),/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&jQuery(window).one("unload",function(){var a=jQuery.timer.global;for(var b in a)if(a.hasOwnProperty(b))for(var c=a[b],d=c.length;--d;)jQuery.timer.remove(c[d],b)}),function(a){if(String.prototype.split.toString().match(/\[native/)){var b,c=String.prototype.split,d=/()??/.exec("")[1]===a;return b=function(b,e,f){if("[object RegExp]"!==Object.prototype.toString.call(e))return c.call(b,e,f);var g,h,i,j,k=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),m=0;for(e=new RegExp(e.source,l+"g"),b+="",d||(g=new RegExp("^"+e.source+"$(?!\\s)",l)),f=f===a?-1>>>0:f>>>0;(h=e.exec(b))&&(i=h.index+h[0].length,!(i>m&&(k.push(b.slice(m,h.index)),!d&&h.length>1&&h[0].replace(g,function(){for(var b=1;b<arguments.length-2;b++)arguments[b]===a&&(h[b]=a)}),h.length>1&&h.index<b.length&&Array.prototype.push.apply(k,h.slice(1)),j=h[0].length,m=i,k.length>=f)));)e.lastIndex===h.index&&e.lastIndex++;return m===b.length?(j||!e.test(""))&&k.push(""):k.push(b.slice(m)),k.length>f?k.slice(0,f):k},String.prototype.split=function(a,c){return b(this,a,c)},b}}(),a.json_stringify=function(c,d){var e,f="";d=d===b?1:d;var g=typeof c;switch(g){case"function":f+=c;break;case"boolean":f+=c?"true":"false";break;case"object":if(null===c)f+="null";else if(c instanceof Array){f+="[";var h=c.length;for(e=0;h-1>e;++e)f+=a.json_stringify(c[e],d+1);f+=a.json_stringify(c[h-1],d+1)+"]"}else{f+="{";for(var i in c)c.hasOwnProperty(i)&&(f+='"'+i+'":'+a.json_stringify(c[i],d+1));f+="}"}break;case"string":var j=c,k={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(e in k)k.hasOwnProperty(e)&&(j=j.replace(new RegExp(e,"g"),k[e]));f+='"'+j+'"';break;case"number":f+=String(c)}return f+=d>1?",":"",1===d&&(f=f.replace(/,([\]}])/g,"$1")),f.replace(/([\[{]),/g,"$1")},a.fn.cmd=function(c){function d(){K.toggleClass("inverted")}function e(){w="(reverse-i-search)`"+B+"': ",N()}function f(){w=v,A=!1,C=null,B=""}function g(a){var b,c,d=y.data(),f=d.length;if(a&&C>0&&(f-=C),B.length>0)for(var g=B.length;g>0;g--){c=B.substring(0,g).replace(/([.*+{}\[\]?])/g,"\\$1"),b=new RegExp(c);for(var h=f;h--;)if(b.test(d[h]))return C=d.length-h,H=0,p.set(d[h],!0),M(),void(B.length!==g&&(B=B.substring(0,g),e()))}B=""}function h(){var a=p.width(),b=K.innerWidth();s=Math.floor(a/b)}function j(a){var b=a.substring(0,s-u),c=a.substring(s-u);return[b].concat(i(c,s))}function k(){r.focus(),p.oneTime(1,function(){p.insert(r.val()),r.blur().val("")})}function o(d){var h,i,j;if(a.isFunction(c.keydown)&&(h=c.keydown(d),h!==b))return h;if(I){if(38===d.which||80===d.which&&d.ctrlKey||(O=!0),!A||35!==d.which&&36!==d.which&&37!==d.which&&38!==d.which&&39!==d.which&&40!==d.which&&13!==d.which&&27!==d.which){if(d.altKey)return 68===d.which?(p.set(E.slice(0,H)+E.slice(H).replace(/ *[^ ]+ *(?= )|[^ ]+$/,""),!0),!1):!0;if(13===d.keyCode)if(d.shiftKey)p.insert("\n");else{y&&E&&!D&&(a.isFunction(c.historyFilter)&&c.historyFilter(E)||!c.historyFilter)&&y.append(E);var l=E;y.reset(),p.set(""),c.commands&&c.commands(l),a.isFunction(w)&&N()}else if(8===d.which)A?(B=B.slice(0,-1),e()):""!==E&&H>0&&(E=E.slice(0,H-1)+E.slice(H,E.length),--H,M());else if(67===d.which&&d.ctrlKey&&d.shiftKey)F=t();else if(86===d.which&&d.ctrlKey&&d.shiftKey)""!==F&&p.insert(F);else if(9!==d.which||d.ctrlKey||d.altKey){if(46===d.which)return""!==E&&H<E.length&&(E=E.slice(0,H)+E.slice(H+1,E.length),M()),!0;if(y&&38===d.which||80===d.which&&d.ctrlKey)O?(L=E,p.set(y.current())):p.set(y.previous()),O=!1;else if(y&&40===d.which||78===d.which&&d.ctrlKey)p.set(y.end()?L:y.next());else if(37===d.which||66===d.which&&d.ctrlKey)if(d.ctrlKey&&66!==d.which){j=H-1,i=0," "===E[j]&&--j;for(var m=j;m>0;--m){if(" "===E[m]&&" "!==E[m+1]){i=m+1;break}if("\n"===E[m]&&"\n"!==E[m+1]){i=m;break}}p.position(i)}else H>0&&(--H,M());else if(82===d.which&&d.ctrlKey)A?g(!0):(v=w,e(),L=E,E="",M(),A=!0);else if(71==d.which&&d.ctrlKey)A&&(w=v,N(),E=L,M(),A=!1,B="");else if(39===d.which||70===d.which&&d.ctrlKey)if(d.ctrlKey&&70!==d.which){" "===E[H]&&++H;var n=/\S[\n\s]{2,}|[\n\s]+\S?/,q=E.slice(H).match(n);!q||q[0].match(/^\s+$/)?H=E.length:" "!==q[0][0]?H+=q.index+1:(H+=q.index+q[0].length-1," "!==q[0][q[0].length-1]&&--H),M()}else H<E.length&&(++H,M());else{if(123===d.which)return!0;if(36===d.which)p.position(0);else if(35===d.which)p.position(E.length);else{if(d.shiftKey&&45==d.which)return k(),!0;if(!d.ctrlKey&&!d.metaKey)return!0;if(192===d.which)return!0;if(d.metaKey){if(82===d.which)return!0;if(76===d.which)return!0}if(d.shiftKey){if(84===d.which)return!0}else{if(81===d.which){if(""!==E&&0!==H){var r=E.slice(0,H),s=E.slice(H+1),u=r.match(/([^ ]+ *$)/);H=r.length-u[0].length,G=r.slice(H),E=r.slice(0,H)+s,M()}return!1}if(72===d.which)return""!==E&&H>0&&(E=E.slice(0,--H),H<E.length-1&&(E+=E.slice(H)),M()),!1;if(65===d.which)p.position(0);else if(69===d.which)p.position(E.length);else{if(88===d.which||67===d.which||84===d.which)return!0;if(89===d.which)""!==G&&p.insert(G);else{if(86===d.which)return k(),!0;if(75===d.which)0===H?(G=E,p.set("")):H!==E.length&&(G=E.slice(H),p.set(E.slice(0,H)));else if(85===d.which)""!==E&&0!==H&&(G=E.slice(0,H),p.set(E.slice(H,E.length)),p.position(0));else if(17===d.which)return!1}}}}}}else p.insert("	")}else f(),N(),27===d.which&&(E=""),M(),o.call(this,d);return!1}}var p=this,q=p.data("cmd");if(q)return q;p.addClass("cmd"),p.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var r=a("<textarea/>").addClass("clipboard").appendTo(p);c.width&&p.width(c.width);var s,u,v,w,x,y,z,A=!1,B="",C=null,D=c.mask||!1,E="",F="",G="",H=0,I=c.enabled,J=c.historySize||60,K=p.find(".cursor");z=n()?function(a){a?K.addClass("blink"):K.removeClass("blink")}:function(a){a&&!I?(K.addClass("inverted"),p.everyTime(500,"blink",d)):I&&(p.stopTime("blink",d),K.removeClass("inverted"))};var L,M=function(b){function c(b,c){var d=b.length;if(c===d)g.html(a.terminal.encode(b,!0)),K.html("&nbsp;"),h.html("");else if(0===c)g.html(""),K.html(a.terminal.encode(b.slice(0,1),!0)),h.html(a.terminal.encode(b.slice(1),!0));else{var e=b.slice(0,c);g.html(a.terminal.encode(e,!0));var f=b.slice(c,c+1);K.html(a.terminal.encode(f,!0)),h.html(c===b.length-1?"":a.terminal.encode(b.slice(c+1),!0))}}function d(b){return"<div>"+a.terminal.encode(b,!0)+"</div>"}function e(b){var c=h;a.each(b,function(b,e){c=a(d(e)).insertAfter(c).addClass("clear")})}function f(b){a.each(b,function(a,b){g.before(d(b))})}var g=K.prev(),h=K.next();return function(){var k,l;switch(typeof D){case"boolean":k=D?E.replace(/./g,"*"):E;break;case"string":k=E.replace(/./g,D)}var m,n;if(b.find("div").remove(),g.html(""),k.length>s-u-1||k.match(/\n/)){var o,p=k.match(/\t/g),q=p?3*p.length:0;if(p&&(k=k.replace(/\t/g,"\x00\x00\x00\x00")),k.match(/\n/)){var r=k.split("\n");for(n=s-u-1,m=0;m<r.length-1;++m)r[m]+=" ";for(r[0].length>n?(o=[r[0].substring(0,n)],l=r[0].substring(n),o=o.concat(i(l,s))):o=[r[0]],m=1;m<r.length;++m)r[m].length>s?o=o.concat(i(r[m],s)):o.push(r[m])}else o=j(k);if(p&&(o=a.map(o,function(a){return a.replace(/\x00\x00\x00\x00/g,"	")})),n=o[0].length,0===n&&1===o.length);else if(n>H)c(o[0],H),e(o.slice(1));else if(H===n)g.before(d(o[0])),c(o[1],0),e(o.slice(2));else{var t=o.length;if(n>H)c(o[0],H),e(o.slice(1));else if(H===n)g.before(d(o[0])),c(o[1],0),e(o.slice(2));else{var v=o.slice(-1)[0],w=k.length-H-q,x=v.length,y=0;if(x>=w)f(o.slice(0,-1)),y=x===w?0:x-w,c(v,y);else if(3===t)l=a.terminal.encode(o[0],!0),g.before("<div>"+l+"</div>"),c(o[1],H-n-1),l=a.terminal.encode(o[2],!0),h.after('<div class="clear">'+l+"</div>");else{var z,A;for(y=H,m=0;m<o.length;++m){var B=o[m].length;if(!(y>B))break;y-=B}A=o[m],z=m,y===A.length&&(y=0,A=o[++z]),c(A,y),f(o.slice(0,z)),e(o.slice(z+1))}}}}else""===k?(g.html(""),K.html("&nbsp;"),h.html("")):c(k,H)}}(p),N=function(){function b(b){u=m(b),c.html(a.terminal.format(a.terminal.encode(b)))}var c=p.find(".prompt");return function(){switch(typeof w){case"string":b(w);break;case"function":w(b)}}}(),O=!0;a.extend(p,{name:function(a){if(a!==b){x=a;var c=y&&y.enabled()||!y;return y=new l(a,J),c||y.disable(),p}return x},purge:function(){return y.clear(),p},history:function(){return y},set:function(d,e){return d!==b&&(E=d,e||(H=E.length),M(),a.isFunction(c.onCommandChange)&&c.onCommandChange(E)),p},insert:function(b,d){return H===E.length?E+=b:E=0===H?b+E:E.slice(0,H)+b+E.slice(H),d||(H+=b.length),M(),a.isFunction(c.onCommandChange)&&c.onCommandChange(E),p},get:function(){return E},commands:function(a){return a?(c.commands=a,p):a},destroy:function(){return a(document.documentElement||window).unbind(".cmd"),p.stopTime("blink",d),p.find(".cursor").next().remove().end().prev().remove().end().remove(),p.find(".prompt, .clipboard").remove(),p.removeClass("cmd").removeData("cmd"),p},prompt:function(a){if(a===b)return w;if("string"!=typeof a&&"function"!=typeof a)throw"prompt must be a function or string";return w=a,N(),M(),p},kill_text:function(){return G},position:function(a){return"number"==typeof a?(H=0>a?0:a>E.length?E.length:a,M(),p):H},visible:function(){var a=p.visible;return function(){a.apply(p,[]),M(),N()}}(),show:function(){var a=p.show;return function(){a.apply(p,[]),M(),N()}}(),resize:function(a){return a?s=a:h(),M(),p},enable:function(){return I=!0,z(!0),p},isenabled:function(){return I},disable:function(){return I=!1,z(!1),p},mask:function(a){return"undefined"==typeof a?D:(D=a,M(),p)}}),p.name(c.name||c.prompt||""),w=c.prompt||"> ",N(),(c.enabled===b||c.enabled===!0)&&p.enable();return a(document.documentElement||window).bind("keypress.cmd",function(d){var f;if(d.ctrlKey&&99===d.which)return!0;if(!A&&a.isFunction(c.keypress)&&(f=c.keypress(d)),f!==b&&!f)return f;if(I){if(a.inArray(d.which,[38,13,0,8])>-1&&123!==d.keyCode&&(38!==d.which||!d.shiftKey))return!1;if(!d.ctrlKey&&(!d.altKey||100!==d.which)||d.altKey)return A?(B+=String.fromCharCode(d.which),g(),e()):p.insert(String.fromCharCode(d.which)),!1}}).bind("keydown.cmd",o),p.data("cmd",p),p};var y=["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],z=/(\[\[[gbiuso]*;[^;]*;[^\]]*\](?:[^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?)/i,A=/\[\[([gbiuso]*);([^;]*);([^;\]]*);?([^;\]]*);?([^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,B=/\[\[([gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,C=/^\[\[([gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]$/gi,D=/^#([0-9a-f]{3}|[0-9a-f]{6})$/i,E=/\bhttps?:\/\/(?:(?!&[^;]+;)[^\s"'<>)])+\b/g,F=/((([^<>('")[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,})))/g,G=/('[^']*'|"(\\"|[^"])*"|\/(\\\/|[^\/])+\/[gimy]*|(\\ |[^ ])+|[\w-]+)/g,H=/(\[\[[gbiuso]*;[^;]*;[^\]]*\])/i,I=/\[\[[gbiuso]*;[^;]*;[^\]]*\]?$/i;a.terminal={valid_color:function(b){return b.match(D)?!0:-1!==a.inArray(b.toLowerCase(),y)},escape_regex:function(a){var b=/([\^\$\[\]\(\)\+\*\.\|])/g;return a.replace(b,"\\$1")},have_formatting:function(a){return a.match(B)},is_formatting:function(a){return a.match(C)},format_split:function(a){return a.split(z)},split_equal:function(a,b){for(var c=!1,d=!1,e="",f=[],g=a.replace(B,function(a,b,c){var d=b.match(/;/g).length;return d=2==d?";;":3==d?";":"","[["+b+d+c.replace(/\\\]/g,"&#93;").replace(/\n/g,"\\n")+"]"+c+"]"}).split(/\n/g),h=0,i=g.length;i>h;++h)if(""!==g[h])for(var j=g[h],k=0,l=0,m=0,n=j.length;n>m;++m){if("["===j[m]&&"["===j[m+1])c=!0;else if(c&&"]"===j[m])d?(c=!1,d=!1):d=!0;else if(c&&d||!c){if("&"===j[m]){var o=j.substring(m).match(/^(&[^;]+;)/);if(!o)throw"Unclosed html entity in line "+(h+1)+" at char "+(m+1);m+=o[1].length-2,m===n-1&&f.push(p+o[1]);continue}"]"===j[m]&&"\\"===j[m-1]?--l:++l}if(l===b||m===n-1){var p=j.substring(k,m+1);e&&(p=e+p,p.match("]")&&(e="")),k=m+1,l=0;var q=p.match(B);if(q){var r=q[q.length-1];if("]"!==r[r.length-1])e=r.match(H)[1],p+="]";else if(p.match(I)){{var s=p.length;s-r[r.length-1].length}p=p.replace(I,""),e=r.match(H)[1]}}f.push(p)}}else f.push("");return f},encode:function(a,b){return a=b?a.replace(/&(?![^=]+=)/g,"&amp;"):a.replace(/&(?!#[0-9]+;|[a-zA-Z]+;|[^= "]+=[^=])/g,"&amp;"),a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},format:function(b,c){var d=a.extend({},{linksNoReferrer:!1},c||{});if("string"==typeof b){var e=a.terminal.format_split(b);return e&&e.length>1&&(b=a.map(e,function(b){return""===b?b:"["===b.substring(0,1)?b.replace(A,function(b,c,d,e,f,g,h){if(""===h)return"";h=h.replace(/\\]/g,"]");var c="";-1!==c.indexOf("b")&&(c+="font-weight:bold;");var i=[];-1!==c.indexOf("u")&&i.push("underline"),-1!==c.indexOf("s")&&i.push("line-through"),-1!==c.indexOf("o")&&i.push("overline"),i.length&&(c+="text-decoration:"+i.join(" ")+";"),-1!==c.indexOf("i")&&(c+="font-style:italic;"),a.terminal.valid_color(d)&&(c+="color:"+d+";",-1!==c.indexOf("g")&&(c+="text-shadow:0 0 5px "+d+";")),a.terminal.valid_color(e)&&(c+="background-color:"+e);var j;j=""===g?h:g.replace(/&#93;/g,"]");var k='<span style="'+c+'"';return""!==f&&(k+=' class="'+f+'"'),k+=' data-text="'+j.replace('"',"&quote;")+'">'+h+"</span>"}):"<span>"+b+"</span>"}).join("")),a.map(b.split(/(<\/?span[^>]*>)/g),function(a){return a.match(/span/)?a:a.replace(E,function(a){var b=a.match(/\.$/);a=a.replace(/\.$/,"");var c='<a target="_blank" ';return d.linksNoReferer&&(c+='rel="noreferrer" '),c+=' href="'+a+'">'+a+"</a>"+(b?".":"")}).replace(F,'<a href="mailto:$1">$1</a>')}).join("").replace(/<span><br\/?><\/span>/g,"<br/>")}return""},escape_brackets:function(a){return a.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")},strip:function(a){return a.replace(A,"$6")},active:function(){return R.front()},overtyping:function(a){return a.replace(/((?:_\x08.|.\x08_)+)/g,function(a){var b=a.replace(/_x08|\x08_|_\u0008|\u0008_/g,"");return"[[u;;]"+b+"]"}).replace(/((?:.\x08.)+)/g,function(a){return"[[b;#fff;]"+a.replace(/(.)(?:\x08|\u0008)(.)/g,function(a,b,c){return c})+"]"})},ansi_colors:{normal:{black:"#000",red:"#A00",green:"#008400",yellow:"#A50",blue:"#00A",magenta:"#A0A",cyan:"#0AA",white:"#AAA"},faited:{black:"#000",red:"#640000",green:"#006100",yellow:"#737300",blue:"#000087",magenta:"#650065",cyan:"#008787",white:"#818181"},bold:{black:"#000",red:"#F55",green:"#44D544",yellow:"#FF5",blue:"#55F",magenta:"#F5F",cyan:"#5FF",white:"#FFF"},palette:["#000000","#AA0000","#00AA00","#AA5500","#0000AA","#AA00AA","#00AAAA","#AAAAAA","#555555","#FF5555","#55FF55","#FFFF55","#5555FF","#FF55FF","#55FFFF","#FFFFFF","#000000","#00005F","#000087","#0000AF","#0000D7","#0000FF","#005F00","#005F5F","#005F87","#005FAF","#005FD7","#005FFF","#008700","#00875F","#008787","#0087AF","#0087D7","#00AF00","#00AF5F","#00AF87","#00AFAF","#00AFD7","#00AFFF","#00D700","#00D75F","#00D787","#00D7AF","#00D7D7","#00D7FF","#00FF00","#00FF5F","#00FF87","#00FFAF","#00FFD7","#00FFFF","#5F0000","#5F005F","#5F0087","#5F00AF","#5F00D7","#5F00FF","#5F5F00","#5F5F5F","#5F5F87","#5F5FAF","#5F5FD7","#5F5FFF","#5F8700","#5F875F","#5F8787","#5F87AF","#5F87D7","#5F87FF","#5FAF00","#5FAF5F","#5FAF87","#5FAFAF","#5FAFD7","#5FAFFF","#5FD700","#5FD75F","#5FD787","#5FD7AF","#5FD7D7","#5FD7FF","#5FFF00","#5FFF5F","#5FFF87","#5FFFAF","#5FFFD7","#5FFFFF","#870000","#87005F","#870087","#8700AF","#8700D7","#8700FF","#875F00","#875F5F","#875F87","#875FAF","#875FD7","#875FFF","#878700","#87875F","#878787","#8787AF","#8787D7","#8787FF","#87AF00","#87AF5F","#87AF87","#87AFAF","#87AFD7","#87AFFF","#87D700","#87D75F","#87D787","#87D7AF","#87D7D7","#87D7FF","#87FF00","#87FF5F","#87FF87","#87FFAF","#87FFD7","#87FFFF","#AF0000","#AF005F","#AF0087","#AF00AF","#AF00D7","#AF00FF","#AF5F00","#AF5F5F","#AF5F87","#AF5FAF","#AF5FD7","#AF5FFF","#AF8700","#AF875F","#AF8787","#AF87AF","#AF87D7","#AF87FF","#AFAF00","#AFAF5F","#AFAF87","#AFAFAF","#AFAFD7","#AFAFFF","#AFD700","#AFD75F","#AFD787","#AFD7AF","#AFD7D7","#AFD7FF","#AFFF00","#AFFF5F","#AFFF87","#AFFFAF","#AFFFD7","#AFFFFF","#D70000","#D7005F","#D70087","#D700AF","#D700D7","#D700FF","#D75F00","#D75F5F","#D75F87","#D75FAF","#D75FD7","#D75FFF","#D78700","#D7875F","#D78787","#D787AF","#D787D7","#D787FF","#D7AF00","#D7AF5F","#D7AF87","#D7AFAF","#D7AFD7","#D7AFFF","#D7D700","#D7D75F","#D7D787","#D7D7AF","#D7D7D7","#D7D7FF","#D7FF00","#D7FF5F","#D7FF87","#D7FFAF","#D7FFD7","#D7FFFF","#FF0000","#FF005F","#FF0087","#FF00AF","#FF00D7","#FF00FF","#FF5F00","#FF5F5F","#FF5F87","#FF5FAF","#FF5FD7","#FF5FFF","#FF8700","#FF875F","#FF8787","#FF87AF","#FF87D7","#FF87FF","#FFAF00","#FFAF5F","#FFAF87","#FFAFAF","#FFAFD7","#FFAFFF","#FFD700","#FFD75F","#FFD787","#FFD7AF","#FFD7D7","#FFD7FF","#FFFF00","#FFFF5F","#FFFF87","#FFFFAF","#FFFFD7","#FFFFFF","#080808","#121212","#1C1C1C","#262626","#303030","#3A3A3A","#444444","#4E4E4E","#585858","#626262","#6C6C6C","#767676","#808080","#8A8A8A","#949494","#9E9E9E","#A8A8A8","#B2B2B2","#BCBCBC","#C6C6C6","#D0D0D0","#DADADA","#E4E4E4","#EEEEEE"]},from_ansi:function(){function b(b){var e,f=b.split(";"),g=!1,h=!1,i=!1,j=[],k="",l="",m=!1,n=!1,o=!1,p=a.terminal.ansi_colors.palette;for(var q in f){switch(e=parseInt(f[q],10)){case 1:j.push("b"),i=!0,g=!1;break;case 4:j.push("u");break;case 3:j.push("i");break;case 5:o=!0;break;case 38:m=!0;break;case 48:n=!0;break;case 2:g=!0,i=!1;break;case 7:h=!0;break;default:m&&o&&p[e-1]?k=p[e-1]:c[e]&&(k=c[e]),n&&o&&p[e-1]?l=p[e-1]:d[e]&&(l=d[e])}5!==e&&(o=!1)}if(h)if(k&&l){var r=l;l=k,k=r}else k="black",l="white";var s,t,u,v;return s=v=i?a.terminal.ansi_colors.bold:g?a.terminal.ansi_colors.faited:a.terminal.ansi_colors.normal,u=n?l:v[l],t=m?k:s[k],[j.join(""),t,u]}var c={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white",39:"white"},d={40:"black",41:"red",42:"green",43:"yellow",44:"blue",45:"magenta",46:"cyan",47:"white",49:"black"};return function(a){var c=a.split(/(\x1B\[[0-9;]*[A-Za-z])/g);if(1==c.length)return a;var d=[];if(c.length>3){var e=c.slice(0,3).join("");("[0m"==e||"[m"==e)&&(c=c.slice(3))}for(var f,g,h,i,j=!1,k=0;k<c.length;++k)if(i=c[k].match(/^\x1B\[([0-9;]*)([A-Za-z])$/))switch(i[2]){case"m":"0"!==i[1]&&(h=b(i[1])),j?(d.push("]"),"0"==i[1]||""==i[1]?(j=!1,f=g=""):(h[1]=h[1]||f,h[2]=h[2]||g,d.push("[["+h.join(";")+"]"),h[1]&&(f=h[1]),h[2]&&(g=h[2]))):"0"!=i[1]&&(j=!0,d.push("[["+h.join(";")+"]"),h[1]&&(f=h[1]),h[2]&&(g=h[2]))}else d.push(c[k]);return j&&d.push("]"),d.join("")}}(),parseArguments:function(b){var c=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;return a.map(b.match(G)||[],function(a){if("'"===a[0]&&"'"===a[a.length-1])return a.replace(/^'|'$/g,"");if('"'===a[0]&&'"'===a[a.length-1])return a=a.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"),a.replace(/\\\\|\\t|\\n/g,function(a){return"t"===a[1]?"	":"n"===a[1]?"\n":"\\"}).replace(/\\x([0-9a-f]+)/gi,function(a,b){return String.fromCharCode(parseInt(b,16))}).replace(/\\0([0-7]+)/g,function(a,b){return String.fromCharCode(parseInt(b,8))});if(a.match(/^\/(\\\/|[^\/])+\/[gimy]*$/)){var b=a.match(/^\/([^\/]+)\/([^\/]*)$/);return new RegExp(b[1],b[2])}return a.match(/^-?[0-9]+$/)?parseInt(a,10):a.match(c)?parseFloat(a):a.replace(/\\ /g," ")})},splitArguments:function(b){return a.map(b.match(G)||[],function(a){return"'"===a[0]&&"'"===a[a.length-1]?a.replace(/^'|'$/g,""):'"'===a[0]&&'"'===a[a.length-1]?a.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"):"/"===a[0]&&"/"==a[a.length-1]?a:a.replace(/\\ /g," ")})},parseCommand:function(b){return o(b,a.terminal.parseArguments)},splitCommand:function(b){return o(b,a.terminal.splitArguments)}},a.fn.visible=function(){return this.css("visibility","visible")},a.fn.hidden=function(){return this.css("visibility","hidden")};var J={};a.jrpc=function(b,c,d,e,f){J[b]=J[b]||0;var g=a.json_stringify({jsonrpc:"2.0",method:c,params:d,id:++J[b]});return a.ajax({url:b,data:g,success:function(b,c,d){var g=d.getResponseHeader("Content-Type");if(!g.match(/application\/json/)){var h="Response Content-Type is not application/json";if(!console||!console.warn)throw new Error("WARN: "+h);console.warn(h)}var i;try{i=a.parseJSON(b)}catch(j){if(!f)throw new Error("Invalid JSON");return void f(d,"Invalid JSON",j)}e(i,c,d)},error:f,contentType:"application/json",dataType:"text",async:!0,cache:!1,type:"POST"})};var K="0.9.0",L=!K.match(/^\{\{/),M="Copyright (c) 2011-2014 Jakub Jankiewicz <http://jcubic.pl>",N=L?" version "+K:" ",O=new RegExp(" {"+N.length+"}$"),P=[["jQuery Terminal","(c) 2011-2013 jcubic"],["jQuery Terminal Emulator"+(L?" v. "+K:""),M.replace(/ *<.*>/,"")],["jQuery Terminal Emulator"+(L?N:""),M.replace(/^Copyright /,"")],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(O," ")+N,M],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(O,"")+N,M]];a.terminal.defaults={prompt:"> ",history:!0,exit:!0,clear:!0,enabled:!0,historySize:60,maskChar:"*",checkArity:!0,exceptionHandler:null,cancelableAjax:!0,processArguments:!0,linksNoReferrer:!1,historyState:!1,historyStateUrlMapper:function(){var b=window.location.href.replace(/\/[^\/]*$/,"");return function(c){var d=a.terminal.splitCommand(c),e=b+"/"+d.name+"/"+d.args.join("/");return e}}(),login:null,outputLimit:-1,onAjaxError:null,onRPCError:null,completion:!1,historyFilter:null,onInit:a.noop,onClear:a.noop,onBlur:a.noop,onFocus:a.noop,onTerminalChange:a.noop,onExit:a.noop,keypress:a.noop,keydown:a.noop,strings:{wrongPasswordTryAgain:"Wrong password try again!",wrongPassword:"Wrong password!",ajaxAbortError:"Error while aborting ajax call!",wrongArity:"Wrong number of arguments. Function '%s' expect %s got%s!",commandNotFound:"Command '%s' Not Found!",oneRPCWithIgnore:"You can use only one rpc with ignoreSystemDescribe",oneInterpreterFunction:"You can't use more then one function (rpcwith ignoreSystemDescribe is count as one)",loginFunctionMissing:"You don't have login function",noTokenError:"Access denied (no token)",serverResponse:"Server reponse is",wrongGreetings:"Wrong value of greetings parameter",notWhileLogin:"You can't call that function while in login",loginIsNotAFunction:"Authenticate must be a function",canExitError:"You can't exit from main interpeter",invalidCompletion:"Invalid completion",invalidSelector:'Sorry, but terminal said that "%s" is not valid selector!',login:"login",password:"password"}};
var Q=[],R=new j,S=[],T=!0;a.fn.terminal=function(c,d){function e(b){return a.isFunction(kb.processArguments)?o(b,kb.processArguments):kb.processArguments?a.terminal.parseCommand(b):a.terminal.splitCommand(b)}function f(b){X.echo("string"==typeof b?b:b instanceof Array?a.map(b,function(b){return a.json_stringify(b)}).join(" "):"object"==typeof b?a.json_stringify(b):b)}function g(b){a.isFunction(kb.onRPCError)?kb.onRPCError.call(X,b):X.error("&#91;RPC&#93; "+b.message)}function h(b){var c=function(c,d){X.pause(),a.jrpc(b,c,d,function(b){b.error?g(b.error):a.isFunction(kb.processRPCResponse)?kb.processRPCResponse.call(X,b.result):f(b.result),X.resume()},j)};return function(a,b){if(""!==a)if(a=e(a),kb.login&&"help"!==a.name){var d=b.token();d?c(a.name,[d].concat(a.args)):b.error("&#91;AUTH&#93; "+lb.noTokenError)}else c(a.name,a.args)}}function i(c,d,f){return function(g,h){if(""!==g){var j=e(g),k=c[j.name],l=a.type(k);if("function"===l){if(!d||k.length===j.args.length)return k.apply(X,j.args);X.error("&#91;Arity&#93; "+sprintf(lb.wrongArity,j.name,k.length,j.args.length))}else if("object"===l||"string"===l){var m=[];"object"===l&&(m=Object.keys(k),k=i(k,d)),h.push(k,{prompt:j.name+"> ",name:j.name,completion:"object"===l?m:b})}else a.isFunction(f)?f(g,X):a.isFunction(kb.onCommandNotFound)?kb.onCommandNotFound(g,X):h.error(sprintf(lb.commandNotFound,j.name))}}}function j(b,c,d){X.resume(),a.isFunction(kb.onAjaxError)?kb.onAjaxError.call(X,b,c,d):"abort"!==c&&X.error("&#91;AJAX&#93; "+c+" - "+lb.serverResponse+": \n"+b.responseText)}function l(b,c){a.jrpc(b,"system.describe",[],function(d){if(d.procs){var e={};a.each(d.procs,function(c,d){e[d.name]=function(){var c=Array.prototype.slice.call(arguments);kb.checkArity&&d.params&&d.params.length!==c.length?X.error("&#91;Arity&#93; "+sprintf(lb.wrongArity,d.name,d.params.length,c.length)):(X.pause(),a.jrpc(b,d.name,c,function(a){a.error?g(a.error):f(a.result),X.resume()},j))}}),c(e)}else c(null)},function(){c(null)})}function m(b,c){c=c||a.noop;var d,e,f=a.type(b),g={},j=0;if("array"===f){var k={};!function m(b,c){if(b.length){var d=b[0],f=b.slice(1),g=a.type(d);"string"===g?(j++,X.pause(),kb.ignoreSystemDescribe?(1===j?e=h(d):X.error(lb.oneRPCWithIgnore),m(f,c)):l(d,function(b){b&&a.extend(k,b),X.resume(),m(f,c)})):"function"===g?e?X.error(lb.oneInterpreterFunction):e=d:"object"===g&&(a.extend(k,d),m(f,c))}else c()}(b,function(){c({interpreter:i(k,!1,e),completion:Object.keys(k)})})}else if("string"===f)kb.ignoreSystemDescribe?c({interpreter:h(b),completion:kb.completion}):(X.pause(),l(b,function(a){a?(g.interpreter=i(a,!1),g.completion=d):(g.interpreter=h(b),g.completion=kb.completion),X.resume(),c(g)}));else if("object"===f)c({interpreter:i(b,kb.checkArity),completion:Object.keys(b)});else{if("undefined"===f)b=a.noop;else if("function"!==f)throw f+" is invalid interpreter value";c({interpreter:b,completion:kb.completion})}}function n(b,c){var d="boolean"===a.type(c)?"login":c;return function(c,e,f){X.pause(),a.jrpc(b,d,[c,e],function(a){X.resume(),f(!a.error&&a.result?a.result:null)},j)}}function q(a){return"string"==typeof a?a:"string"==typeof a.fileName?a.fileName+": "+a.message:a.message}function v(b,c){a.isFunction(kb.exceptionHandler)?kb.exceptionHandler.call(X,b):X.exception(b,c)}function x(){var a;a=Y.prop?Y.prop("scrollHeight"):Y.attr("scrollHeight"),Y.scrollTop(a)}function y(b,c){try{if(a.isFunction(c))c(function(){});else if("string"!=typeof c){var d=b+" must be string or function";throw d}}catch(e){return v(e,b.toUpperCase()),!1}return!0}function z(b,c){try{var d=a.extend({raw:!1,finalize:a.noop},c||{});b="function"===a.type(b)?b():b,b="string"===a.type(b)?b:String(b);var e,f;if(d.raw||(b=a.terminal.encode(b)),b=a.terminal.overtyping(b),b=a.terminal.from_ansi(b),U.push(V),!d.raw&&(b.length>_||b.match(/\n/))){var g=a.terminal.split_equal(b,_);for(e=0,f=g.length;f>e;++e)U.push(""===g[e]||"\r"===g[e]?"&nbsp;":d.raw?g[e]:a.terminal.format(g[e],{linksNoReferer:kb.linksNoReferer}))}else d.raw||(b=a.terminal.format(b,{linksNoReferer:kb.linksNoReferer})),U.push(b);U.push(d.finalize)}catch(h){U=[],alert("[Internal Exception(draw_line)]:"+q(h)+"\n"+h.stack)}}function A(){sb.resize(_);var b,c=$.empty().detach();if(kb.outputLimit>=0){var d=0===kb.outputLimit?X.rows():kb.outputLimit;b=eb.slice(eb.length-d-1)}else b=eb;a.each(b,function(a,b){z.apply(null,b)}),sb.before(c),X.flush()}function B(){if(kb.greetings===b)X.echo(X.signature);else if(kb.greetings){var a=typeof kb.greetings;"string"===a?X.echo(kb.greetings):"function"===a?kb.greetings.call(X,X.echo):X.error(lb.wrongGreetings)}}function C(b){b=a.terminal.escape_brackets(a.terminal.encode(b,!0));var c=sb.prompt(),d=sb.mask();switch(typeof d){case"string":b=b.replace(/./g,d);break;case"boolean":d&&(b=b.replace(/./g,kb.maskChar))}var e={finalize:function(a){a.addClass("command")}};a.isFunction(c)?c(function(a){X.echo(a+b,e)}):X.echo(c+b,e)}function D(a){var b=kb.historyStateUrlMapper(a),c=kb.historyStateTitleMapper(a);X.save_state(c,b)}function E(){try{if(S.length){var b,c;null===history.state?(b=S[0],c=R.get()[0]):(b=S[history.state.position],c=R.get()[history.state.id]),c.import_view(b.view),b.join.length&&a.each(b.join,function(a,b){var c=R.get()[b.id];c.import_view(b.view)})}}catch(d){v(d,"TERMINAL")}}function F(c,d,e){if(W&&kb.historyState)if(W=!1,S.length){var f=history.state.position||S.length-1;S[f].join.push({id:fb,view:a.extend(X.export_view(),{focus:!1})})}else S.push({view:X.export_view(),join:[]});try{N()||(Z=a.terminal.splitCommand(c).name,(e&&a.isFunction(kb.historyFilter)&&kb.historyFilter(c)||!kb.historyFilter)&&sb.history().append(c));var g=rb.top();if("exit"===c&&kb.exit){var h=rb.size();X.token(),(1==h&&X.token()||h>1)&&(d||C(c),X.pop())}else{d||C(c);var i=eb.length-1;if("clear"===c&&kb.clear)X.clear();else{var j=g.interpreter(c,X);kb.historyState&&(nb?X.bind("resume",function(){D(c),X.unbind("resume")}):D(c)),j!==b&&(i===eb.length-1?(eb.pop(),j!==!1&&X.echo(j)):eb=j===!1?eb.slice(0,i).concat(eb.slice(i+1)):eb.slice(0,i).concat([j]).concat(eb.slice(i+1)),X.resize())}}}catch(k){throw v(k,"USER"),X.resume(),k}}function G(){if(a.isFunction(kb.onBeforeLogout))try{if(kb.onBeforeLogout(X)===!1)return}catch(b){throw v(b,"onBeforeLogout"),b}if(H(),a.isFunction(kb.onAfterLogout))try{kb.onAfterLogout(X)}catch(b){throw v(b,"onAfterlogout"),b}X.login(kb.login,!0,L)}function H(){var b=X.prefix_name(!0)+"_";a.Storage.remove(b+"token"),a.Storage.remove(b+"login")}function I(b){var c=X.prefix_name()+"_interpreters",d=a.Storage.get(c);d=d?a.parseJSON(d):[],-1==a.inArray(b,d)&&(d.push(b),a.Storage.set(c,a.json_stringify(d)))}function J(b){var c=rb.top(),d=X.prefix_name(!0);N()||I(d),sb.name(d),sb.prompt(a.isFunction(c.prompt)?function(a){c.prompt(a,X)}:c.prompt),sb.set(""),!b&&a.isFunction(c.onStart)&&c.onStart(X)}function L(){J(),B();var b=!1;if(a.isFunction(kb.onInit)){hb=function(){b=!0};try{kb.onInit(X)}catch(c){throw v(c,"OnInit"),c}finally{hb=a.noop,b||X.resume()}}kb.historyState&&T&&(T=!1,a(window).on("popstate",E))}function M(b,c,d){var e=sb.get().substring(0,sb.position());if(e===b){for(var f=new RegExp("^"+a.terminal.escape_regex(c)),g=[],h=d.length;h--;)f.test(d[h])&&g.push(d[h]);if(1===g.length)X.insert(g[0].replace(f,""));else if(g.length>1)if(db>=2)C(b),X.echo(g.join("	")),db=0;else{var i,j=!1;a:for(i=c.length;i<g[0].length;++i){for(h=1;h<g.length;++h)if(g[0].charAt(i)!==g[h].charAt(i))break a;j=!0}j&&X.insert(g[0].slice(0,i).replace(f,""))}}}function N(){return gb||sb.mask()!==!1}function O(c){var d,e,f=rb.top();if(a.isFunction(f.keydown)&&(d=f.keydown(c,X),d!==b))return d;var g;if(g=kb.completion&&"boolean"!=a.type(kb.completion)&&!f.completion?kb.completion:f.completion,X.oneTime(10,function(){ob()}),a.isFunction(kb.keydown)&&(d=kb.keydown(c,X),d!==b))return d;if(X.paused()){if(68===c.which&&c.ctrlKey){if(Q.length){for(e=Q.length;e--;){var h=Q[e];if(4!==h.readyState)try{h.abort()}catch(i){X.error(m.ajaxAbortError)}}Q=[],X.resume()}return!1}}else{if(9!==c.which&&(db=0),68===c.which&&c.ctrlKey)return gb||(""===sb.get()?rb.size()>1||kb.login!==b?X.pop(""):(X.resume(),X.echo("")):X.set_command("")),!1;if(76===c.which&&c.ctrlKey)X.clear();else{if(g&&9===c.which){++db;var j,k=sb.position(),l=sb.get().substring(0,k),m=l.split(" ");if(1==m.length)j=m[0];else for(j=m[m.length-1],e=m.length-1;e>0&&"\\"==m[e-1][m[e-1].length-1];e--)j=m[e-1]+" "+j;switch(a.type(g)){case"function":g(X,j,function(a){M(l,j,a)});break;case"array":M(l,j,g);break;default:throw new Error(m.invalidCompletion)}return!1}if(86===c.which&&c.ctrlKey)return void X.oneTime(1,function(){x()});if(9===c.which&&c.ctrlKey){if(R.length()>1)return X.focus(!1),!1}else 34===c.which?X.scroll(X.height()):33===c.which?X.scroll(-X.height()):X.attr({scrollTop:X.attr("scrollHeight")})}}}var U=[],V=1,W=!0,X=this;if(this.length>1)return this.each(function(){a.fn.terminal.call(a(this),c,a.extend({name:X.selector},d))});if(X.data("terminal"))return X.data("terminal");if(0===X.length)throw sprintf(a.terminal.defaults.strings.invalidSelector,X.selector);var Y,Z,$,_,ab,bb,cb,db=0,eb=[],fb=R.length(),gb=!1,hb=a.noop,ib=[],jb={name:X.selector,historyStateTitleMapper:function(b){var c=a("title").text();return c+" ["+b+"]"}},kb=a.extend({},a.terminal.defaults,jb,d||{}),lb=a.terminal.defaults.strings,mb=kb.enabled,nb=!1;a.extend(X,a.omap({clear:function(){$.html(""),sb.set(""),eb=[];try{kb.onClear(X)}catch(a){throw v(a,"onClear"),a}return X.attr({scrollTop:0}),X},export_view:function(){if(gb)throw new Exception(lb.notWhileLogin);return{focus:mb,mask:sb.mask(),prompt:X.get_prompt(),command:X.get_command(),position:sb.position(),lines:w(eb)}},import_view:function(a){if(gb)throw new Exception(lb.notWhileLogin);return X.set_prompt(a.prompt),X.set_command(a.command),sb.position(a.position),sb.mask(a.mask),a.focus&&X.focus(),eb=w(a.lines),A(),X},save_state:function(a,b){var c={id:fb,position:S.length};history.pushState(c,a,b),S.push({view:X.export_view(),join:[]})},exec:function(a,b){return nb?ib.push([a,b]):F(a,b,!0),X},login:function(b,c,d,e){if(gb)throw new Error(lb.notWhileLogin);if(!a.isFunction(b))throw new Error(lb.loginIsNotAFunction);if(X.token(!0)&&X.login_name(!0))return a.isFunction(d)&&d(),X;return kb.history&&sb.history().disable(),gb=!0,X.push(function(f){X.set_mask(kb.maskChar).push(function(g){try{b.call(X,f,g,function(b,g){if(b){X.pop().pop(),kb.history&&sb.history().enable();var h=X.prefix_name(!0)+"_";a.Storage.set(h+"token",b),a.Storage.set(h+"login",f),gb=!1,a.isFunction(d)&&d()}else c?(g||X.error(lb.wrongPasswordTryAgain),X.pop().set_mask(!1)):(gb=!1,g||X.error(lb.wrongPassword),X.pop().pop()),a.isFunction(e)&&e()})}catch(h){v(h,"USER(authentication)")}},{prompt:lb.password+": "})},{prompt:lb.login+": "})},settings:kb,commands:function(){return rb.top().interpreter},setInterpreter:function(b,c){function d(){X.pause(),m(b,function(b){X.resume();var c=rb.top();a.extend(c,b),J(!0)})}"string"==a.type(b)&&c?X.login(n(b,c),!0,d):d()},greetings:function(){return B(),X},paused:function(){return nb},pause:function(){return hb(),!nb&&sb&&(nb=!0,X.disable(),sb.hidden()),X},resume:function(){if(nb&&sb){nb=!1,X.enable(),sb.visible();var a=ib;for(ib=[];a.length;)X.exec.apply(X,a.shift());X.trigger("resume"),x()}return X},cols:function(){return _},rows:function(){return ab},history:function(){return sb.history()},next:function(){if(1===R.length())return X;{var b=X.offset().top;X.height(),X.scrollTop()}if(p(X)){R.front().disable();var c=R.rotate().enable(),d=c.offset().top-50;a("html,body").animate({scrollTop:d},500);try{kb.onTerminalChange(c)}catch(e){throw v(e,"onTerminalChange"),e}return c}return X.enable(),a("html,body").animate({scrollTop:b-50},500),X},focus:function(a,b){return X.oneTime(1,function(){if(1===R.length())if(a===!1)try{b||kb.onBlur(X)===!1||X.disable()}catch(c){throw v(c,"onBlur"),c}else try{b||kb.onFocus(X)===!1||X.enable()}catch(c){throw v(c,"onFocus"),c}else if(a===!1)X.next();else{var d=R.front();if(d!=X&&(d.disable(),!b))try{kb.onTerminalChange(X)}catch(c){throw v(c,"onTerminalChange"),c}R.set(X),X.enable()}}),X},enable:function(){return _===b&&X.resize(),sb&&(sb.enable(),mb=!0),X},disable:function(){return sb&&(mb=!1,sb.disable()),X},enabled:function(){return mb},signature:function(){var a=X.cols(),b=15>a?null:35>a?0:55>a?1:64>a?2:75>a?3:4;return null!==b?P[b].join("\n")+"\n":""},version:function(){return K},cmd:function(){return sb},get_command:function(){return sb.get()},set_command:function(a){return sb.set(a),X},insert:function(a){if("string"==typeof a)return sb.insert(a),X;throw"insert function argument is not a string"},set_prompt:function(b){return y("prompt",b)&&(sb.prompt(a.isFunction(b)?function(a){b(a,X)}:b),rb.top().prompt=b),X},get_prompt:function(){return rb.top().prompt},set_mask:function(a){return sb.mask(a===!0?kb.maskChar:a),X},get_output:function(b){return b?eb:a.map(eb,function(b){return a.isFunction(b[0])?b[0]():b[0]}).join("\n")},resize:function(b,c){b&&c&&(X.width(b),X.height(c)),b=X.width(),c=X.height();var d=r(X),e=s(X);return(d!==_||e!==ab)&&(_=d,ab=e,A(),a.isFunction(kb.onResize)&&kb.onResize(X),cb=c,bb=b),X},flush:function(){try{var b;if(a.each(U,function(c,d){if(d===V)b=a("<div></div>");else if(a.isFunction(d)){b.appendTo($);try{d(b)}catch(e){v(e,"USER:echo(finalize)")}}else a("<div/>").html(d).appendTo(b).width("100%")}),kb.outputLimit>=0){var c=0===kb.outputLimit?X.rows():kb.outputLimit,d=$.find("div div");if(d.length>c){var e=eb.length-c+1,f=d.slice(0,e),g=f.parent();f.remove(),g.each(function(){var b=a(this);b.is(":empty")&&b.remove()})}}x(),U=[]}catch(h){alert("[Flush] "+q(h)+"\n"+h.stack)}return X},echo:function(b,c){try{b=b||"";var d=a.extend({flush:!0,raw:!1,finalize:a.noop},c||{});U=[],z(b,d),eb.push([b,d]),d.flush&&X.flush(),ob()}catch(e){alert("[Terminal.echo] "+q(e)+"\n"+e.stack)}return X},error:function(b,c){var d=a.terminal.escape_brackets(b).replace(/\\$/,"&#92;");return X.echo("[[;#f00;]"+d+"]",c)},exception:function(b,c){var d=q(b);c&&(d="&#91;"+c+"&#93;: "+d),d&&X.error(d,{finalize:function(a){a.addClass("exception message")}}),"string"==typeof b.fileName&&(X.pause(),a.get(b.fileName,function(a){X.resume();var c=b.lineNumber-1,d=a.split("\n")[c];d&&X.error("["+b.lineNumber+"]: "+d)})),b.stack&&X.error(b.stack,{finalize:function(a){a.addClass("exception stack-trace")}})},scroll:function(a){var b;return a=Math.round(a),Y.prop?(a>Y.prop("scrollTop")&&a>0&&Y.prop("scrollTop",0),b=Y.prop("scrollTop"),Y.scrollTop(b+a)):(a>Y.attr("scrollTop")&&a>0&&Y.attr("scrollTop",0),b=Y.attr("scrollTop"),Y.scrollTop(b+a)),X},logout:kb.login?function(){for(;rb.size()>1;)X.pop();return X.pop()}:function(){X.error(lb.loginFunctionMissing)},token:kb.login?function(b){return a.Storage.get(X.prefix_name(b)+"_token")}:a.noop,set_token:function(b,c){a.Storage.set(X.prefix_name(c)+"_token",b)},get_token:function(b){return a.Storage.get(X.prefix_name(b)+"_token")},login_name:kb.login?function(b){return a.Storage.get(X.prefix_name(b)+"_login")}:a.noop,name:function(){return rb.top().name},prefix_name:function(a){var b=(kb.name?kb.name+"_":"")+fb;return a&&rb.size()>1&&(b+="_"+rb.map(function(a){return a.name}).slice(1).join("_")),b},push:function(b,c){c=c||{},c.name=c.name||Z,c.prompt=c.prompt||c.name+" ";var d=rb.top();return d&&(d.mask=sb.mask()),m(b,function(d){if(rb.push(a.extend({},d,c)),c.login){var e=a.type(c.login);"function"==e?X.login(c.login,!1,J,X.pop):("string"==a.type(b)&&"string"==e||"boolean"==e)&&X.login(n(b,c.login),!1,J,X.pop)}else J()}),X},pop:function(c){c!==b&&C(c);var d=X.token(!0);if(1==rb.size())if(kb.login){if(G(),a.isFunction(kb.onExit))try{kb.onExit(X)}catch(e){throw v(e,"onExit"),e}}else X.error(lb.canExitError);else{d&&H();var f=rb.pop();if(J(),a.isFunction(f.onExit))try{f.onExit(X)}catch(e){throw v(e,"onExit"),e}X.set_mask(rb.top().mask)}return X},level:function(){return rb.size()},reset:function(){for(X.clear();rb.size()>1;)rb.pop();return L(),X},purge:function(){var b=X.prefix_name()+"_",c=a.Storage.get(b+"interpreters");return a.each(a.parseJSON(c),function(b,c){a.Storage.remove(c+"_commands"),a.Storage.remove(c+"_token"),a.Storage.remove(c+"_login")}),sb.purge(),a.Storage.remove(b+"interpreters"),X},destroy:function(){return sb.destroy().remove(),$.remove(),a(document).unbind(".terminal"),a(window).unbind(".terminal"),X.unbind("click, mousewheel"),X.removeData("terminal").removeClass("terminal"),kb.width&&X.css("width",""),kb.height&&X.css("height",""),R.remove(fb),R.length()||a(window).off("popstate",E),X}},function(a,b){return function(){try{return b.apply(this,[].slice.apply(arguments))}catch(c){throw"exec"!==a&&"resume"!==a&&v(c,"TERMINAL"),c}}}));var ob=function(){var a=u(X);return function(){a!==u(X)&&(X.resize(),a=u(X))}}();kb.width&&X.width(kb.width),kb.height&&X.height(kb.height);var pb=navigator.userAgent.toLowerCase();if(Y=pb.match(/(webkit)[ \/]([\w.]+)/)||"body"!=X[0].tagName.toLowerCase()?X:a("html"),a(document).bind("ajaxSend.terminal",function(a,b){Q.push(b)}),$=a("<div>").addClass("terminal-output").appendTo(X),X.addClass("terminal"),("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(X.click(function(){X.find("textarea").focus()}),X.find("textarea").focus()),kb.login&&a.isFunction(kb.onBeforeLogin))try{kb.onBeforeLogin(X)}catch(qb){throw v(qb,"onBeforeLogin"),qb}"string"!=typeof c||"string"!=typeof kb.login&&!kb.login||(kb.login=n(c,kb.login)),R.append(X);var rb,sb;return m(c,function(c){rb=new k(a.extend({name:kb.name,prompt:kb.prompt,greetings:kb.greetings},c)),sb=a("<div/>").appendTo(X).cmd({prompt:kb.prompt,history:kb.history,historyFilter:kb.historyFilter,historySize:kb.historySize,width:"100%",keydown:O,keypress:kb.keypress?function(a){return kb.keypress(a,X)}:null,onCommandChange:function(b){if(a.isFunction(kb.onCommandChange))try{kb.onCommandChange(b,X)}catch(c){throw v(c,"onCommandChange"),c}x()},commands:F}),mb?X.focus(b,!0):X.disable(),a(document).bind("click.terminal",function(b){var c=a(b.target);c.closest(".terminal").hasClass("terminal")||kb.onBlur(X)===!1||X.disable()});var d,e=a(window).focus(function(){d&&X.focus()}).blur(function(){d=mb,X.disable()});if(X.click(function(){X.enabled()||X.focus()}).mousedown(function(a){2==a.which&&X.insert(t())}),kb.login?X.login(kb.login,!0,L):L(),X.is(":visible")&&(_=r(X),sb.resize(_),ab=s(X)),X.oneTime(100,function(){e.bind("resize.terminal",function(){if(X.is(":visible")){var a=X.width(),b=X.height();(cb!==b||bb!==a)&&X.resize()}})}),a.event.special.mousewheel){var f=!1;a(document).bind("keydown.terminal",function(a){a.shiftKey&&(f=!0)}).bind("keyup.terminal",function(a){(a.shiftKey||16==a.which)&&(f=!1)}),X.mousewheel(function(a,b){f||X.scroll(b>0?-40:40)})}}),X.data("terminal",X),X}}(jQuery);